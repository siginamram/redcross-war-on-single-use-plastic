<mat-card class="students-container">
  <div class="header-row">
    <div>
      <h2><mat-icon class="header-icon">group</mat-icon> Manage Students</h2>
      <p>View registered students or add a new one.</p>
    </div>
    <button mat-raised-button color="primary" [routerLink]="['/home/core/students-form']">
      <mat-icon>person_add</mat-icon> Add Student
    </button>
  </div>

  <!-- Filters -->
  <div class="filter-row">
    <mat-form-field appearance="outline">
      <mat-label>Zone</mat-label>
      <mat-select [(value)]="selectedZone" (selectionChange)="onZoneChange()">
        <mat-option *ngFor="let zone of zones" [value]="zone.zoneID">{{ zone.zoneName }}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Cluster</mat-label>
      <mat-select [(value)]="selectedCluster" (selectionChange)="onClusterChange()">
        <mat-option *ngFor="let cluster of clusters" [value]="cluster.clusterId">{{ cluster.clusterName }}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>School</mat-label>
      <mat-select [(value)]="selectedSchool" (selectionChange)="onSchoolChange()">
        <mat-option *ngFor="let school of schools" [value]="school.schoolID">{{ school.schoolName }}</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <!-- Table -->
  <div class="table-wrapper">
    <table mat-table [dataSource]="dataSource" class="mat-elevation-z1 full-width">

      <!-- S.No -->
      <ng-container matColumnDef="sno">
        <th mat-header-cell *matHeaderCellDef class="green-header">
          <mat-icon class="green-icon">format_list_numbered</mat-icon> S.No
        </th>
        <td mat-cell *matCellDef="let row; let i = index">
          {{ i + 1 + (paginator.pageIndex * paginator.pageSize) }}
        </td>
      </ng-container>

      <!-- Student Name -->
      <ng-container matColumnDef="studentName">
        <th mat-header-cell *matHeaderCellDef class="green-header">
          <mat-icon class="green-icon">person</mat-icon> Name
        </th>
        <td mat-cell *matCellDef="let row"> {{ row.studentName }} </td>
      </ng-container>

      <!-- Class -->
      <ng-container matColumnDef="classID">
        <th mat-header-cell *matHeaderCellDef class="green-header">
          <mat-icon class="green-icon">class</mat-icon> Class
        </th>
        <td mat-cell *matCellDef="let row"> {{ row.className }} </td>
      </ng-container>

      <!-- Section -->
      <ng-container matColumnDef="sectionID">
        <th mat-header-cell *matHeaderCellDef class="green-header">
          <mat-icon class="green-icon">view_week</mat-icon> Section
        </th>
        <td mat-cell *matCellDef="let row"> {{ row.sectionName }} </td>
      </ng-container>

      <!-- Roll Number -->
      <ng-container matColumnDef="rollNumber">
        <th mat-header-cell *matHeaderCellDef class="green-header">
          <mat-icon class="green-icon">confirmation_number</mat-icon> Roll No
        </th>
        <td mat-cell *matCellDef="let row"> {{ row.rollNumber }} </td>
      </ng-container>

      <!-- Gender -->
      <ng-container matColumnDef="gender">
        <th mat-header-cell *matHeaderCellDef class="green-header">
          <mat-icon class="green-icon">wc</mat-icon> Gender
        </th>
        <td mat-cell *matCellDef="let row">
          {{ row.gender === 1 ? 'Male' : row.gender === 2 ? 'Female' : 'Other' }}
        </td>
      </ng-container>

      <!-- Photo -->
      <ng-container matColumnDef="photoLink">
        <th mat-header-cell *matHeaderCellDef class="green-header">
          <mat-icon class="green-icon">image</mat-icon> Photo
        </th>
        <td mat-cell *matCellDef="let row">
          <a [href]="row.photoLink" target="_blank" rel="noopener noreferrer">View</a>
        </td>
      </ng-container>
      
       <!-- Reward Points -->
      <ng-container matColumnDef="rewardPoint">
        <th mat-header-cell *matHeaderCellDef class="green-header">
          <mat-icon class="green-icon">star</mat-icon> Reward Points
        </th>
        <td mat-cell *matCellDef="let row">
          <button mat-button color="accent" (click)="openRewardPopup(row)">
            {{ row.rewardPoint || 0 }}
          </button>
        </td>
      </ng-container>

      <!-- Actions -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef class="green-header">
          <mat-icon class="green-icon">edit</mat-icon> Actions
        </th>
        <td mat-cell *matCellDef="let row">
         <button mat-icon-button color="accent" (click)="editStudent(row)">
            <mat-icon>edit</mat-icon>
          </button>
        </td>
      </ng-container>

      <!-- Table Rows -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <!-- No Data Message -->
    <div class="no-data" *ngIf="dataSource.data.length === 0">
      <mat-icon>info</mat-icon>
      <span>No students found for the selected filters.</span>
    </div>

    <!-- Paginator -->
    <mat-paginator #paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
  </div>
</mat-card>
