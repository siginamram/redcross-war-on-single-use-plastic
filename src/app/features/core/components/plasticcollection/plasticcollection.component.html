<div class="collection-container">
  <h2><mat-icon class="header-icon">recycling</mat-icon> Students - Plastic Collection Entry</h2>
  <p>Select class, section & date to enter or update plastic collection.</p>

  <div class="filters-row">
    <mat-form-field appearance="outline" floatLabel="always">
      <mat-label>Class</mat-label>
      <mat-select [(value)]="selectedClass" (selectionChange)="onFiltersChange()">
        <mat-option *ngFor="let c of classList" [value]="c.classID">{{ c.className }}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" floatLabel="always">
      <mat-label>Section</mat-label>
      <mat-select [(value)]="selectedSection" (selectionChange)="onFiltersChange()">
        <mat-option *ngFor="let s of sectionList" [value]="s.sectionID">{{ s.sectionName }}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" floatLabel="always">
      <mat-label>Collection Date</mat-label>
      <input matInput [matDatepicker]="picker" [(ngModel)]="collectionDate" (dateChange)="onFiltersChange()" />
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
    </mat-form-field>
  </div>

  <form [formGroup]="collectionForm" (ngSubmit)="onSubmit()">
    <div class="student-table">
      <table class="mat-elevation-z1">
        <thead>
          <tr>
            <th>S.NO</th>
            <th><mat-icon>person</mat-icon> Name</th>
            <th><mat-icon>badge</mat-icon> Roll No</th>
            <th><mat-icon>scale</mat-icon> Weight (KG)</th>
          </tr>
        </thead>
        <tbody formArrayName="students">
          <tr *ngFor="let student of studentsArray.controls; let i = index" [formGroupName]="i">
            <td>{{ i + 1 }}</td>
            <!-- Just display studentName -->
            <td>{{ student.get('studentName')?.value }}</td>

            <!-- Just display rollNumber -->
            <td>{{ student.get('rollNumber')?.value }}</td>
              <td>
                  <mat-form-field appearance="outline">
                  <input
                  matInput
                  formControlName="weightKG"
                  placeholder="0.0"
                  type="number"
                  />
                  <mat-error *ngIf="student.get('weightKG')?.hasError('required')">
                  Weight is required.
                  </mat-error>
                  <mat-error *ngIf="student.get('weightKG')?.hasError('pattern')">
                  Enter valid weight (e.g., 1.5).
                  </mat-error>
                  </mat-form-field>
              </td>

          </tr>
        </tbody>
      </table>
    </div>

      <!-- Plastic Collection Photo URL Field -->
    <mat-form-field appearance="outline" style="width: 100%; margin-top: 16px;">
    <mat-label>Plastic Collection Photo URL</mat-label>
    <input
      matInput
      formControlName="imageUrl"
      placeholder="Paste collection photo URL"
    />
    <mat-error *ngIf="collectionForm.get('imageUrl')?.hasError('required')">
      Photo URL is required.
    </mat-error>
    <mat-error *ngIf="collectionForm.get('imageUrl')?.hasError('pattern')">
      Please enter a valid image URL (e.g., https://example.com/image.jpg).
    </mat-error>
    </mat-form-field>

    <div class="button-container">
      <button mat-raised-button color="primary" type="submit" style="background-color: #2e7d32; color: white; border-radius: 10px;">
        <mat-icon>save</mat-icon> Save Collection
      </button>
    </div>
  </form>
</div>
